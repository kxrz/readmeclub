---
// Layout
import BaseLayout from "@/layouts/BaseLayout.astro";
// Fundation
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import WallpaperCard from "@/components/wallpapers/WallpaperCard.astro";
import { supabase } from '@/lib/supabase/client';
import { useTranslations } from '@/i18n/utils';
import type { Lang } from '@/i18n/utils';

const lang = (Astro.params.lang || 'en') as Lang;
const t = useTranslations(lang);

const url = Astro.url;
const category = url.searchParams.get('category') || null;
const limit = 50;
const offset = 0;

let query = supabase
  .from('wallpapers')
  .select('*')
  .eq('status', 'published')
  .eq('hidden', false)
  .order('created_at', { ascending: false })
  .range(offset, offset + limit - 1);

if (category) {
  query = query.eq('category', category);
}

const { data: wallpapers } = await query;

const categories = [
  { value: 'minimalist', label: t('wallpapers.category.minimalist') },
  { value: 'dark', label: t('wallpapers.category.dark') },
  { value: 'light', label: t('wallpapers.category.light') },
  { value: 'pop_culture', label: t('wallpapers.category.pop_culture') },
  { value: 'custom', label: t('wallpapers.category.custom') },
  { value: 'other', label: t('wallpapers.category.other') },
];
---

<BaseLayout>
  <section>
    <Wrapper variant="hero">
      <Text
        tag="h1"
        variant="displaySM"
        class="text-base-900 font-medium 2xl:text-5xl tracking-tight"
      >
        {t('wallpapers.title')}
      </Text>
      <Text
        tag="p"
        variant="textBase"
        class="mt-4 text-base-600 text-balance 2xl:text-xl"
      >
        {t('wallpapers.subtitle')}
      </Text>
      <div class="mt-4">
        <a
          href={`/${lang}/submit`}
          class="inline-flex items-center gap-1.5 text-sm text-base-500 hover:text-accent-500 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="shrink-0"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 5v14"></path>
            <path d="M5 12h14"></path>
          </svg>
          {t('wallpapers.add_new')}
        </a>
      </div>
    </Wrapper>
  </section>
  
  <section>
    <Wrapper variant="standard" class="py-6">
      <!-- Filters -->
      <div class="flex flex-wrap gap-2 mb-6">
        <a
          href={`/${lang}/wallpapers`}
          class={`px-4 py-2 rounded-full text-sm font-medium transition-colors ${
            !category
              ? 'bg-accent-500 text-white'
              : 'bg-base-100 text-base-700 hover:bg-base-200'
          }`}
        >
          {t('common.filter')}: All
        </a>
        {categories.map((cat) => (
          <a
            href={`/${lang}/wallpapers?category=${cat.value}`}
            class={`px-4 py-2 rounded-full text-sm font-medium transition-colors ${
              category === cat.value
                ? 'bg-accent-500 text-white'
                : 'bg-base-100 text-base-700 hover:bg-base-200'
            }`}
          >
            {cat.label}
          </a>
        ))}
      </div>
      
      <!-- Wallpapers Grid -->
      {wallpapers && wallpapers.length > 0 ? (
        <div class="grid grid-cols-2 gap-4 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5">
          {wallpapers.map((wallpaper) => (
            <WallpaperCard wallpaper={wallpaper} />
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <Text tag="p" variant="textBase" class="text-base-500">
            {t('wallpapers.no_results')}
          </Text>
        </div>
      )}
    </Wrapper>
  </section>
</BaseLayout>

