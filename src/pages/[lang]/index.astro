---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Hero from "@/components/landing/Hero.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import ResourceCard from "@/components/resources/ResourceCard.astro";
import WallpaperCard from "@/components/wallpapers/WallpaperCard.astro";
import SmallResourceCard from "@/components/resources/SmallResourceCard.astro";
import SmallMoreCard from "@/components/resources/SmallMoreCard.astro";
import MoreCard from "@/components/common/MoreCard.astro";
import Seo from "@/components/fundations/head/Seo.astro";
import { supabase } from '@/lib/supabase/client';
import { useTranslations } from '@/i18n/utils';
import type { Lang } from '@/i18n/utils';

const lang = (Astro.params.lang || 'en') as Lang;
const t = useTranslations(lang);
const siteUrl = Astro.site || 'https://readme.club';

// Fetch featured resources
const { data: featuredResources } = await supabase
  .from('resources')
  .select('*')
  .eq('status', 'approved')
  .eq('hidden', false)
  .order('downloads_count', { ascending: false })
  .limit(8);

// Fetch starred resources
const { data: starredResources } = await supabase
  .from('resources')
  .select('*')
  .eq('status', 'approved')
  .eq('hidden', false)
  .eq('starred', true)
  .order('created_at', { ascending: false })
  .limit(6);

// Fetch latest wallpapers
const { data: latestWallpapers } = await supabase
  .from('wallpapers')
  .select('*')
  .eq('status', 'published')
  .eq('hidden', false)
  .order('created_at', { ascending: false })
  .limit(4);
---

<BaseLayout>
  <Fragment slot="head">
    <Seo
      title={`${t('site.name')} - ${t('site.tagline')}`}
      description={t('site.description')}
      canonical={`${siteUrl}/${lang === 'en' ? '' : lang}`}
      lang={lang}
    />
  </Fragment>
  <Hero />
  
  {featuredResources && featuredResources.length > 0 && (
    <section>
      <Wrapper variant="standard" class="pt-6 pb-24">
        <div class="flex flex-col gap-4 lg:flex-row lg:justify-between border-t border-base-200 pt-2">
          <Text
            tag="h2"
            variant="textXS"
            class="font-medium uppercase text-base-600"
          >
            {t('resources.title')}
          </Text>
          <Text
            tag="a"
            variant="textXS"
            href={`/${lang}/resources`}
            aria-label={t('nav.resources')}
            class="text-base-600 uppercase hover:text-accent-500 flex items-center gap-1 transition-all duration-200"
          >
            {t('common.view')} all
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-narrow-right"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M5 12l14 0"></path>
              <path d="M15 16l4 -4"></path>
              <path d="M15 8l4 4"></path>
            </svg>
          </Text>
        </div>
        <div class="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4 mt-8">
          {featuredResources.map((resource) => (
            <ResourceCard resource={resource} />
          ))}
          <MoreCard href={`/${lang}/resources`} label={t('common.view') + ' all'} />
        </div>
      </Wrapper>
    </section>
  )}

  {starredResources && starredResources.length > 0 && (
    <section>
      <Wrapper variant="standard" class="pt-6 pb-24">
        <div class="border-t border-base-200 pt-2">
          <Text
            tag="h2"
            variant="textXS"
            class="font-medium uppercase text-base-600"
          >
            {t('resources.starred_resources')}
          </Text>
        </div>
        <div class="grid grid-cols-1 gap-2 mt-6">
          {starredResources.map((resource) => (
            <SmallResourceCard resource={resource} />
          ))}
          <SmallMoreCard href={`/${lang}/resources`} label={t('common.view') + ' all'} />
        </div>
      </Wrapper>
    </section>
  )}

  {latestWallpapers && latestWallpapers.length > 0 && (
    <section>
      <Wrapper variant="standard" class="pt-6 pb-24">
        <div class="flex flex-col gap-4 lg:flex-row lg:justify-between border-t border-base-200 pt-2">
          <Text
            tag="h2"
            variant="textXS"
            class="font-medium uppercase text-base-600"
          >
            {t('wallpapers.title')}
          </Text>
          <Text
            tag="a"
            variant="textXS"
            href={`/${lang}/wallpapers`}
            aria-label={t('nav.wallpapers')}
            class="text-base-600 uppercase hover:text-accent-500 flex items-center gap-1 transition-all duration-200"
          >
            {t('common.view')} all
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-narrow-right"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M5 12l14 0"></path>
              <path d="M15 16l4 -4"></path>
              <path d="M15 8l4 4"></path>
            </svg>
          </Text>
        </div>
        <div class="grid grid-cols-2 gap-4 md:grid-cols-3 xl:grid-cols-4 mt-8">
          {latestWallpapers.map((wallpaper) => (
            <WallpaperCard wallpaper={wallpaper} />
          ))}
          <MoreCard href={`/${lang}/wallpapers`} label={t('common.view') + ' all'} variant="wallpaper" />
        </div>
      </Wrapper>
    </section>
  )}
  
  <section>
    <Wrapper variant="standard" class="pt-6 pb-24">
      <div class="border-t border-base-200 pt-2">
        <Text
          tag="h2"
          variant="textXS"
          class="font-medium uppercase text-base-600"
        >
          {t('disclaimer.title')}
        </Text>
        <Text
          tag="p"
          variant="textSM"
          class="mt-4 text-base-600"
        >
          {t('disclaimer.content')}
        </Text>
      </div>
    </Wrapper>
  </section>
</BaseLayout>

