---
import Text from "@/components/fundations/elements/Text.astro";
import { useTranslations, getLangFromUrl, getLangPrefix } from '@/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const langPrefix = getLangPrefix(lang);
const t = useTranslations(lang);
---

<div
  x-data="{ 
    show: false,
    init() {
      // Nouvelle clÃ© pour permettre la rÃ©affichage avec le nouveau message
      const dismissed = localStorage.getItem('welcomeBannerDismissed_v2');
      if (!dismissed) {
        // Afficher aprÃ¨s un court dÃ©lai pour une meilleure UX
        setTimeout(() => {
          this.show = true;
        }, 1000);
      }
    },
    close() {
      this.show = false;
      localStorage.setItem('welcomeBannerDismissed_v2', 'true');
    }
  }"
  x-show="show"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="transform translate-x-full opacity-0"
  x-transition:enter-end="transform translate-x-0 opacity-100"
  x-transition:leave="transition ease-in duration-200"
  x-transition:leave-start="transform translate-x-0 opacity-100"
  x-transition:leave-end="transform translate-x-full opacity-0"
  style="display: none;"
  class="fixed bottom-4 right-4 z-50 max-w-sm"
>
  <div class="bg-base-900 dark:bg-base-800 text-base-50 rounded-lg shadow-xl border border-base-200 dark:border-base-700 p-4 lg:p-5 flex flex-col gap-3">
    <div class="flex items-start justify-between gap-3">
      <div class="flex items-start gap-2 flex-1">
        <span class="text-xl shrink-0" aria-hidden="true">ðŸŽ‰</span>
        <div class="flex-1 min-w-0">
          <Text tag="p" variant="textSM" class="font-semibold text-base-50 mb-1">
            {t('welcome.title')}
          </Text>
          <Text tag="p" variant="textXS" class="text-base-300 dark:text-base-400 mb-2">
            {t('welcome.message')}
          </Text>
          <Text tag="p" variant="textXS" class="text-base-400 dark:text-base-500 mb-2">
            {t('welcome.privacy')}
          </Text>
          <a
            href={`${langPrefix}/about#funding`}
            class="text-xs text-accent-400 hover:text-accent-300 underline transition-colors"
          >
            {t('welcome.funding_link')}
          </a>
        </div>
      </div>
      <button
        @click="close()"
        class="shrink-0 text-base-50 hover:text-base-300 focus:outline-none transition-colors p-1"
        aria-label="Close welcome banner"
      >
        <svg
          class="size-4"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>
  </div>
</div>

