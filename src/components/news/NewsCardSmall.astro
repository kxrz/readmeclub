---
import Text from "@/components/fundations/elements/Text.astro";
import Link from "@/components/fundations/components/Link.astro";
import type { News } from '@/lib/supabase/schema';
import type { NewsArticle } from '@/lib/utils/news-loader';
import { useTranslations } from '@/i18n/utils';

interface Props {
  news: News | NewsArticle;
}

const { news } = Astro.props;
const lang = 'en';
const t = useTranslations(lang);

const newsUrl = '/news/' + news.slug;
// Support both old format (featured_image_url) and new format (featured_image)
const featuredImageUrl = ('featured_image_url' in news ? news.featured_image_url : news.featured_image) || null;
const publishedDate = ('published_at' in news && news.published_at) ? new Date(news.published_at) : ('created_at' in news ? new Date(news.created_at) : new Date());
const formattedDate = publishedDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});
---

<a
  href={newsUrl}
  class="group relative flex flex-col rounded-lg border border-base-200 dark:border-base-700 bg-base-50 dark:bg-base-100 dark:bg-base-200 overflow-hidden hover:border-accent-300 dark:hover:border-accent-500 hover:shadow-md transition-all"
>
  <div class="aspect-video w-full overflow-hidden bg-base-100 dark:bg-base-200 max-h-24 sm:max-h-32">
    <img
      src={featuredImageUrl}
      alt={news.title}
      class="h-full w-full object-cover group-hover:scale-105 transition-transform"
      loading="lazy"
      onerror="this.onerror=null; this.src=this.dataset.fallback;"
      data-fallback={'slug' in news ? `/api/news/${news.slug}/og-image.png` : '/icon.svg'}
    />
  </div>
  
  <div class="p-2.5 sm:p-3 flex-1 flex flex-col">
    {news.featured && (
      <span class="inline-block mb-1.5 text-xs uppercase text-accent-600 font-semibold">
        {t('news.featured')}
      </span>
    )}
    
    <Text tag="h3" variant="textXS" class="font-semibold text-base-900 dark:text-base-50 line-clamp-2 group-hover:text-accent-500 dark:group-hover:text-accent-400 dark:group-hover:text-accent-400 mb-1 sm:mb-1.5 text-xs sm:text-sm">
      {news.title}
    </Text>
    
    {news.excerpt && (
      <Text tag="p" variant="textXS" class="text-base-600 dark:text-base-400 line-clamp-2 mb-1.5 sm:mb-2 flex-1 text-xs">
        {news.excerpt}
      </Text>
    )}
    
    <div class="flex items-center gap-2 text-xs text-base-500 dark:text-base-400 mt-auto pt-1.5 sm:pt-2 border-t border-base-200 dark:border-base-700">
      {news.author_name && (
        <>
          <span>{news.author_name}</span>
          <span>â€¢</span>
        </>
      )}
      <time datetime={publishedDate.toISOString()}>{formattedDate}</time>
    </div>
  </div>
</a>
