---
// Assets
import { Image } from "astro:assets";
import Logo from "@/images/logo.svg";
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Link from "../fundations/components/Link.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import LogoComponent from "@/components/global/Logo.astro";
import BuyMeACoffee from "../common/BuyMeACoffee.astro";
// i18n
import { useTranslations, getLangFromUrl, getLangPrefix } from '@/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const langPrefix = getLangPrefix(lang);
const isIndexPage = Astro.url.pathname === "/" || Astro.url.pathname === `/${lang}`;

// Navigation items (header - visible)
const navItems = [
  { href: `${langPrefix}/resources`, text: t('nav.resources') },
  { href: `${langPrefix}/wallpapers`, text: t('nav.wallpapers') },
  { href: `${langPrefix}/download-fonts`, text: t('nav.download_fonts') },
  { href: `${langPrefix}/firmware`, text: t('nav.firmware') },
];

// Navigation items (burger menu - organized by sections)
const burgerItems = [
  // Section 1: Contenu principal / Ressources
  { href: `${langPrefix}/resources`, text: t('nav.resources'), section: 'content' },
  { href: `${langPrefix}/wallpapers`, text: t('nav.wallpapers'), section: 'content' },
  { href: `${langPrefix}/fonts`, text: t('nav.fonts'), section: 'content' },
  { href: `${langPrefix}/download-fonts`, text: t('nav.download_fonts'), section: 'content' },
  { href: `${langPrefix}/firmware`, text: t('nav.firmware'), section: 'content' },
  // Section 2: Actualités / Informations
  { href: `${langPrefix}/news`, text: t('nav.news'), section: 'news' },
  { href: `${langPrefix}/newsletter`, text: t('nav.newsletter'), section: 'news' },
      // Section 3: Aide / Documentation
      { href: `${langPrefix}/start`, text: t('nav.faq'), section: 'help' },
      { href: `${langPrefix}/guide`, text: t('nav.guide'), section: 'help' },
      { href: `${langPrefix}/tips`, text: t('nav.tips'), section: 'help' },
      { href: `${langPrefix}/board`, text: t('nav.board'), section: 'help' },
      { href: `${langPrefix}/contribute`, text: t('nav.i_want_to_contribute'), section: 'help' },
  // Section 4: Utilitaires
  { href: `${langPrefix}/location`, text: t('nav.location'), section: 'utils' },
];

// Items à afficher après Buy Me a Coffee (même style)
const footerItems = [
  { href: `${langPrefix}/about`, text: t('nav.about') },
  { href: `${langPrefix}/disclaimer`, text: t('nav.disclaimer') },
];

// Grouper les items par section pour l'affichage
const burgerSections = [
  {
    key: 'content',
    items: burgerItems.filter(item => item.section === 'content'),
  },
  {
    key: 'news',
    items: burgerItems.filter(item => item.section === 'news'),
  },
  {
    key: 'help',
    items: burgerItems.filter(item => item.section === 'help'),
  },
  {
    key: 'utils',
    items: burgerItems.filter(item => item.section === 'utils'),
  },
].filter(section => section.items.length > 0);
---

<section>
  <Wrapper variant="standard">
    <div
      class="flex items-center justify-between w-full gap-3 pt-2 lg:pt-8"
    >
      <div class="flex items-center gap-2 lg:gap-4">
        <a href={langPrefix || "/"} class="shrink-0">
          <LogoComponent />
        </a>
        {/* Navigation items - visible only on desktop */}
        <div class="hidden lg:flex items-center gap-2 lg:gap-4">
          {
            navItems.map((link) => (
              <Text
                tag="a"
                href={link.href}
                class="text-base-900 text-sm hover:text-accent-500 font-medium"
              >
                {link.text}
              </Text>
            ))
          }
          <button
            type="button"
            @click="rightDrawerOpen = true"
            class="text-base-900 text-sm hover:text-accent-500 font-medium"
            aria-label="Open menu"
          >
            {t('nav.more')}
          </button>
        </div>
      </div>

      {/* Burger menu button */}
      <div class="flex items-center gap-3">
        <button
          type="button"
          class="size-9 inline-flex items-center justify-center group"
          @click="rightDrawerOpen = true"
          aria-label="Open menu"
        >
          <div class="p-1.5 group-focus-visible:bg-base-50">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="text-base-400 size-6 shrink-0 transition duration-300 ease-in-out"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path
                :class="{'opacity-0': rightDrawerOpen}"
                d="M4 8l18 0"
                class="opacity-0"
              ></path>
              <path d="M4 16l18 0"></path>
            </svg>
            <span class="sr-only">Open sidebar</span>
          </div>
        </button>
      </div>
    </div>
  </Wrapper>
</section>

<div
  x-show="rightDrawerOpen"
  x-ref="dialog"
  aria-modal="true"
  style="display: none"
  x-description="off canvas menu for mobile and desktop"
  class="fixed inset-0 z-40 flex justify-end h-full p-2 lg:p-3"
>
  <!-- Overlay -->
  <div
    x-show="rightDrawerOpen"
    x-transition:enter="transition-opacity ease-linear duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity ease-linear duration-300"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 bg-base-600/50"
    @click="rightDrawerOpen = false"
    aria-hidden="true"
  >
  </div>
  <!-- Menu (Right Side) -->
  <div
    x-show="rightDrawerOpen"
    x-transition:enter="transition ease-in-out duration-300 transform"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in-out duration-300 transform"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
    class="relative flex flex-col w-full lg:max-w-[26rem] bg-base-50 shadow-lg h-full overflow-hidden rounded-xl"
  >
    <!-- Close Button -->
    <div
      x-show="rightDrawerOpen"
      x-transition:enter="ease-in-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="ease-in-out duration-300"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="absolute top-0 right-0 p-2 px-6 py-3"
    >
      <button
        type="button"
        class=" text-base-600 hover:text-base-900 focus:outline-none"
        @click="rightDrawerOpen = false"
      >
        <span class="sr-only">Close sidebar</span>
        <svg
          class="size-4"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <!-- Menu Content -->
    <div class="flex-1 overflow-y-auto">
      <div class="flex items-center flex-shrink-0 p-2 py-3 px-6">
        <Text
          tag="p"
          variant="textSM"
          class="uppercase text-base-900 font-semibold"
        >
          {t('nav.home')}
        </Text>
      </div>
      <nav role="navigation">
        <div
          class="flex flex-col gap-6 lg:gap-8 border-t border-base-200 p-2 py-3 px-6"
        >
          {burgerSections.map((section, sectionIndex) => (
            <div>
              {sectionIndex > 0 && (
                <div class="border-t border-base-200 my-4"></div>
              )}
              <ul role="navigation" class="flex flex-col gap-1">
                {section.items.map((item) => (
                  <li>
                    <Text
                      tag="a"
                      variant="textXL"
                      href={item.href}
                      class="text-base-900 font-semibold hover:text-accent-500"
                    >
                      {item.text}
                    </Text>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
        <div class="border-t border-base-200 p-2 py-3 px-6 space-y-3">
          <BuyMeACoffee variant="default" class="text-base-600" />
          <div class="flex flex-col gap-2">
            {footerItems.map((item) => (
              <a
                href={item.href}
                class="inline-flex items-center gap-1.5 text-sm text-base-500 hover:text-accent-500 transition-colors"
              >
                {item.text}
              </a>
            ))}
          </div>
        </div>
      </nav>
    </div>
  </div>
</div>
