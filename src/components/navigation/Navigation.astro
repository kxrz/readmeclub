---
// Assets
import { Image } from "astro:assets";
import Logo from "@/images/logo.svg";
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Link from "../fundations/components/Link.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import LogoComponent from "@/components/global/Logo.astro";
// i18n
import { useTranslations, getLangFromUrl, getLangPrefix } from '@/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const langPrefix = getLangPrefix(lang);
const isIndexPage = Astro.url.pathname === "/" || Astro.url.pathname === `/${lang}`;

// Navigation items (header - visible)
const navItems = [
  { href: `${langPrefix}/resources`, text: t('nav.resources') },
  { href: `${langPrefix}/wallpapers`, text: t('nav.wallpapers') },
  { href: `${langPrefix}/fonts`, text: t('nav.fonts') },
  { href: `${langPrefix}/tips`, text: t('nav.tips') },
];

// Navigation items (burger menu - all)
const burgerItems = [
  { href: `${langPrefix}/resources`, text: t('nav.resources') },
  { href: `${langPrefix}/wallpapers`, text: t('nav.wallpapers') },
  { href: `${langPrefix}/fonts`, text: t('nav.fonts') },
  { href: `${langPrefix}/board`, text: t('nav.board') },
  { href: `${langPrefix}/tips`, text: t('nav.tips') },
  { href: `${langPrefix}/location`, text: t('nav.location') },
  { href: `${langPrefix}/guide`, text: t('nav.guide') },
  { href: `${langPrefix}/about`, text: t('nav.about') },
  { href: `${langPrefix}/disclaimer`, text: t('nav.disclaimer') },
];
---

<section>
  <Wrapper variant="standard">
    <div
      class="flex items-center justify-between w-full gap-3 pt-2 lg:pt-8"
    >
      <div class="flex items-center gap-2 lg:gap-4">
        <a href={langPrefix || "/"} class="shrink-0">
          <LogoComponent />
        </a>
        {/* Navigation items - visible only on desktop */}
        <div class="hidden lg:flex items-center gap-2 lg:gap-4">
          {
            navItems.map((link) => (
              <Text
                tag="a"
                href={link.href}
                class="text-base-900 text-sm hover:text-accent-500 font-medium"
              >
                {link.text}
              </Text>
            ))
          }
          <button
            type="button"
            @click="rightDrawerOpen = true"
            class="text-base-900 text-sm hover:text-accent-500 font-medium"
            aria-label="Open menu"
          >
            {t('nav.more')}
          </button>
        </div>
      </div>

      {/* Burger menu button - visible on all sizes */}
      <button
        type="button"
        class="size-9 inline-flex items-center justify-center group"
        @click="rightDrawerOpen = true"
        aria-label="Open menu"
      >
        <div class="p-1.5 group-focus-visible:bg-base-50">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="fill-base-400 size-6 shrink-0 transition duration-300 ease-in-out"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path
              :class="{'opacity-0': rightDrawerOpen}"
              d="M4 8l18 0"
              class="opacity-0"
            ></path>
            <path d="M4 16l18 0"></path>
          </svg>
          <span class="sr-only">Open sidebar</span>
        </div>
      </button>
    </div>
  </Wrapper>
</section>

<div
  x-show="rightDrawerOpen"
  x-ref="dialog"
  aria-modal="true"
  style="display: none"
  x-description="off canvas menu for mobile and desktop"
  class="fixed inset-0 z-40 flex justify-end h-full p-2 lg:p-3"
>
  <!-- Overlay -->
  <div
    x-show="rightDrawerOpen"
    x-transition:enter="transition-opacity ease-linear duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity ease-linear duration-300"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 bg-base-600/50"
    @click="rightDrawerOpen = false"
    aria-hidden="true"
  >
  </div>
  <!-- Menu (Right Side) -->
  <div
    x-show="rightDrawerOpen"
    x-transition:enter="transition ease-in-out duration-300 transform"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in-out duration-300 transform"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
    class="relative flex flex-col w-full lg:max-w-[26rem] bg-white shadow-lg h-full overflow-hidden rounded-xl"
  >
    <!-- Close Button -->
    <div
      x-show="rightDrawerOpen"
      x-transition:enter="ease-in-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="ease-in-out duration-300"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="absolute top-0 right-0 p-2 px-6 py-3"
    >
      <button
        type="button"
        class=" text-base-600 hover:text-base-900 focus:outline-none"
        @click="rightDrawerOpen = false"
      >
        <span class="sr-only">Close sidebar</span>
        <svg
          class="size-4"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <!-- Menu Content -->
    <div class="flex-1 overflow-y-auto">
      <div class="flex items-center flex-shrink-0 p-2 py-3 px-6">
        <Text
          tag="p"
          variant="textSM"
          class="uppercase text-base-900 font-semibold"
        >
          {t('nav.home')}
        </Text>
      </div>
      <nav role="navigation">
        <div
          class="flex flex-col gap-6 lg:gap-12 border-t border-base-200 p-2 py-3 px-6"
        >
          <ul role="navigation" class="flex flex-col gap-1">
            {burgerItems.map((item) => (
              <li>
                <Text
                  tag="a"
                  variant="textXL"
                  href={item.href}
                  class="text-base-900 font-semibold  hover:text-accent-500"
                >
                  {item.text}
                </Text>
              </li>
            ))}
          </ul>
        </div>
        <div class="border-t border-base-200 p-2 py-3 px-6">
          <Text
            tag="a"
            variant="textSM"
            href="https://donate.stripe.com/28EdR9gtc9Sca4IfP94Vy00"
            target="_blank"
            rel="noopener noreferrer"
            class="text-base-600 hover:text-accent-500 flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-coffee"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M3 14c.83 .642 2.077 1.017 3.5 1c1.423 .017 2.67 -.358 3.5 -1c.83 -.642 2.077 -1.017 3.5 -1c1.423 -.017 2.67 .358 3.5 1"></path>
              <path d="M8 3a2.4 2.4 0 0 0 -1 2a2.4 2.4 0 0 0 1 2"></path>
              <path d="M12 3a2.4 2.4 0 0 0 -1 2a2.4 2.4 0 0 0 1 2"></path>
              <path d="M3 10h14v5a6 6 0 0 1 -6 6h-2a6 6 0 0 1 -6 -6v-5z"></path>
              <path d="M16.746 16.726a3 3 0 1 0 .252 -4.202"></path>
            </svg>
            {t('nav.support_project')}
          </Text>
        </div>
      </nav>
    </div>
  </div>
</div>
