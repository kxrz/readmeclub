---
import type { Wallpaper } from '@/lib/supabase/schema';
import type { WallpaperMetadata } from '@/lib/utils/wallpaper-loader';
import { useTranslations, getLangFromUrl, getLangPrefix } from '@/i18n/utils';

interface Props {
  wallpaper: Wallpaper | WallpaperMetadata;
}

const { wallpaper } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const langPrefix = getLangPrefix(lang);

const wallpaperUrl = langPrefix ? `${langPrefix}/wallpapers/${wallpaper.id}` : `/wallpapers/${wallpaper.id}`;
// Support both old format (file_url) and new format (thumbnail_path)
const imageUrl = ('file_url' in wallpaper ? wallpaper.file_url : wallpaper.thumbnail_path) || '/placeholder-wallpaper.jpg';
---

<a
  href={wallpaperUrl}
  class="group relative flex-shrink-0 w-32 h-48 rounded-lg overflow-hidden border border-base-200 bg-white hover:border-accent-300 hover:shadow-lg transition-all"
  title={wallpaper.title || 'Wallpaper'}
>
  <img
    src={imageUrl}
    alt={wallpaper.title || 'Wallpaper'}
    class="h-full w-full object-cover group-hover:scale-105 transition-transform"
    loading="lazy"
  />
</a>

