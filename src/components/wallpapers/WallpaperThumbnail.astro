---
import type { Wallpaper } from '@/lib/supabase/schema';
import type { WallpaperMetadata } from '@/lib/utils/wallpaper-loader';
import { useTranslations, getLangFromUrl, getLangPrefix } from '@/i18n/utils';

interface Props {
  wallpaper: Wallpaper | WallpaperMetadata;
}

const { wallpaper } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const langPrefix = getLangPrefix(lang);

const wallpaperUrl = langPrefix ? `${langPrefix}/wallpapers/${wallpaper.id}` : `/wallpapers/${wallpaper.id}`;
// Utiliser le thumbnail optimis√© (JPG pour BMP, WebP pour autres formats)
const thumbnailPath = ('thumbnail_path' in wallpaper && wallpaper.thumbnail_path) 
  ? wallpaper.thumbnail_path 
  : `/wallpapers/${wallpaper.id}/thumbnail.webp`;
const isBmp = ('original_path' in wallpaper && wallpaper.original_path?.endsWith('.bmp')) || 
              thumbnailPath.endsWith('.jpg');
const imageUrl = isBmp 
  ? (('thumbnail_path' in wallpaper && wallpaper.thumbnail_path) 
      ? wallpaper.thumbnail_path 
      : `/wallpapers/${wallpaper.id}/thumbnail.jpg`)
  : thumbnailPath;
---

<a
  href={wallpaperUrl}
  class="group relative flex-shrink-0 w-32 h-48 rounded-lg overflow-hidden border border-base-200 bg-white hover:border-accent-300 hover:shadow-lg transition-all"
  title={wallpaper.title || 'Wallpaper'}
>
  <img
    src={imageUrl}
    alt={wallpaper.title || 'Wallpaper'}
    class="h-full w-full object-cover group-hover:scale-105 transition-transform"
    loading="lazy"
  />
</a>

